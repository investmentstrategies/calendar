<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Calendar</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background: #f7f9fb;
    color: #222;
  }
  header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    background: white;
    border-bottom: 1px solid #ddd;
  }
  h1 { font-size: 1.5rem; margin: 0; }
  .controls { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
  input, select, button {
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.9rem;
  }
  button {
    cursor: pointer;
    background: #007aff;
    color: white;
    border: none;
    transition: background 0.2s;
  }
  button:hover { background: #005fd1; }
  main {
    display: grid;
    grid-template-columns: 3fr 1fr;
    min-height: calc(100vh - 70px);
  }
  #calendar {
    padding: 1rem;
    background: #fff;
  }
  #tasks-list {
    border-left: 1px solid #ddd;
    padding: 1rem;
    background: #fafafa;
    overflow-y: auto;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
  }
  .flex { display: flex; gap: 4px; }
  .col {
    flex: 1;
    border: 1px solid #eee;
    background: #fff;
    padding: 6px;
    border-radius: 6px;
    min-height: 600px;
  }
  .day-cell {
    border: 1px solid #eaeaea;
    background: #fff;
    border-radius: 6px;
    padding: 4px;
    min-height: 110px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .day-cell:hover { background: #f0f9ff; }
  .day-number {
    font-size: 0.8rem;
    color: #333;
  }
  .day-dots {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
  }
  .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }
  .task-row {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #fff;
    border: 1px solid #eee;
    border-radius: 6px;
    margin-bottom: 6px;
    padding: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .task-row:hover { background: #f0f9ff; }
  .icon {
    width: 14px;
    height: 14px;
    border-radius: 50%;
  }
  #modal-backdrop, #day-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    align-items: center;
    justify-content: center;
    z-index: 100;
  }
  .modal {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    width: 90%;
    max-width: 420px;
  }
    
    .day-number {
  font-weight: 600;
  margin-bottom: 4px;
  color: #222;
}

  .modal h3 { margin-top: 0; }
  .btn { margin-top: 8px; width: 100%; }
  @media (max-width: 800px) {
    main { grid-template-columns: 1fr; }
    #tasks-list { border-left: none; border-top: 1px solid #ddd; }
    .col { min-height: 400px; }
  }
</style>
</head>
<body>
<header>
  <h1>ðŸ“… Task Calendar</h1>
  <div class="controls">
    <button class="view-btn" data-view="month">Month</button>
    <button class="view-btn" data-view="week">Week</button>
    <button class="view-btn" data-view="3day">3 Day</button>
    <button class="view-btn" data-view="day">Day</button>
    <button id="prev-btn">â—€</button>
    <span id="current-range">October 2025</span>
    <button id="next-btn">â–¶</button>
  </div>
  <div class="controls">
    <input id="task-title" placeholder="New Task title">
    <input id="task-date" type="date">
    <select id="task-course"></select>
    <button id="add-task">+ Task</button>
    <input id="course-name" placeholder="New Course">
    <input id="course-color" type="color" value="#007aff">
    <button id="add-course">+ Course</button>
  </div>
</header>

<main>
  <div id="calendar"></div>
  <div id="tasks-list">
    <h3>Upcoming Tasks</h3>
    <div id="task-items"></div>
  </div>
</main>

<!-- Edit Modal -->
<div id="modal-backdrop">
  <div class="modal">
    <h3>Edit Task</h3>
    <input id="edit-title">
    <input id="edit-date" type="date">
    <select id="edit-course"></select>
    <button id="save-edit" class="btn">Save</button>
    <button id="delete-task" class="btn" style="background:#dc3545">Delete</button>
    <button id="close-modal" class="btn">Cancel</button>
  </div>
</div>

<!-- Day Modal -->
<div id="day-modal">
  <div class="modal" id="day-modal-box">
    <h3 id="day-modal-title">Tasks for this day</h3>
    <div id="day-modal-list"></div>
    <button id="day-modal-close" class="btn" style="margin-top:8px;">Close</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, updateDoc,
    deleteDoc, doc
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // ðŸ”¥ Replace with your actual Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentDate = new Date();
  let viewMode = "month";
  let courses = {};
  let tasks = [];
  let editingTaskId = null;

  const calendarEl = document.getElementById("calendar");
  const taskListEl = document.getElementById("task-items");
  const courseSelect = document.getElementById("task-course");
  const editCourseSelect = document.getElementById("edit-course");
  const modal = document.getElementById("modal-backdrop");
  const editTitle = document.getElementById("edit-title");
  const editDate = document.getElementById("edit-date");
  const dayModal = document.getElementById("day-modal");
  const dayModalTitle = document.getElementById("day-modal-title");
  const dayModalList = document.getElementById("day-modal-list");

  document.getElementById("day-modal-close").addEventListener('click', ()=> dayModal.style.display='none');
  document.getElementById("close-modal").addEventListener("click", ()=>modal.style.display="none");
  document.getElementById("save-edit").addEventListener("click", saveEdit);
  document.getElementById("delete-task").addEventListener("click", deleteTask);
  document.getElementById("prev-btn").addEventListener("click", ()=>changeRange(-1));
  document.getElementById("next-btn").addEventListener("click", ()=>changeRange(1));
  document.getElementById("add-course").addEventListener("click", addCourse);
  document.getElementById("add-task").addEventListener("click", addTask);

  document.querySelectorAll(".view-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      viewMode = btn.dataset.view;
      renderCalendar();
    });
  });

  function changeRange(dir){
    if(viewMode=="month"){ currentDate.setMonth(currentDate.getMonth()+dir); }
    else { currentDate.setDate(currentDate.getDate() + (viewMode=="week"?7:(viewMode=="3day"?3:1))*dir); }
    renderCalendar();
  }

  async function addCourse(){
    const name = document.getElementById("course-name").value.trim();
    const color = document.getElementById("course-color").value;
    if(!name) return alert("Enter a course name");
    const ref = await addDoc(collection(db, "courses"), { name, color });
    courses[ref.id] = { name, color };
    updateCourseSelects();
    document.getElementById("course-name").value="";
  }

  async function addTask(){
    const title = document.getElementById("task-title").value.trim();
    const date = document.getElementById("task-date").value;
    const courseId = courseSelect.value;
    if(!title || !date || !courseId) return alert("Fill all fields");
    const ref = await addDoc(collection(db, "tasks"), { title, due: date, courseId });
    tasks.push({ id: ref.id, title, due: date, courseId });
    document.getElementById("task-title").value="";
    render();
  }

  function openEditModal(task){
    modal.style.display="flex";
    editingTaskId = task.id;
    editTitle.value = task.title;
    editDate.value = task.due;
    editCourseSelect.value = task.courseId;
  }

  async function saveEdit(){
    if(!editingTaskId) return;
    const ref = doc(db, "tasks", editingTaskId);
    const title = editTitle.value;
    const due = editDate.value;
    const courseId = editCourseSelect.value;
    await updateDoc(ref, { title, due, courseId });
    tasks = tasks.map(t=>t.id==editingTaskId?{...t, title, due, courseId}:t);
    modal.style.display="none"; render();
  }

  async function deleteTask(){
    if(!editingTaskId) return;
    await deleteDoc(doc(db,"tasks",editingTaskId));
    tasks = tasks.filter(t=>t.id!=editingTaskId);
    modal.style.display="none"; render();
  }

  function openDayTasksModal(date, list){
    dayModal.style.display='flex';
    dayModalTitle.textContent = `Tasks for ${date.toLocaleDateString()}`;
    dayModalList.innerHTML='';
    if(list.length===0){
      dayModalList.innerHTML='<div class="small muted">No tasks</div>';
      return;
    }
    list.forEach(t=>{
      const el = document.createElement('div');
      el.className='task-row';
      const icon=document.createElement('span');
      icon.className='icon';
      icon.style.background=courses[t.courseId]?.color || '#777';
      const text=document.createElement('div');
      text.textContent=`${t.title} â€¢ ${courses[t.courseId]?.name||''}`;
      el.appendChild(icon);
      el.appendChild(text);
      el.addEventListener('click',()=>openEditModal(t));
      dayModalList.appendChild(el);
    });
  }

  function updateCourseSelects(){
    const opts = Object.entries(courses).map(([id,c])=>`<option value="${id}">${c.name}</option>`).join("");
    courseSelect.innerHTML = '<option value="">Select Course</option>' + opts;
    editCourseSelect.innerHTML = opts;
  }

function renderCalendar(){
  calendarEl.innerHTML = "";
  let start, days;
  const header = document.getElementById("current-range");

  if(viewMode=="month"){
    const year=currentDate.getFullYear(), month=currentDate.getMonth();
    start=new Date(year, month, 1);
    const firstDay=start.getDay();
    start.setDate(start.getDate()-firstDay);
    days=42;
    header.textContent=`${currentDate.toLocaleString('default',{month:'long'})} ${year}`;
  }else if(viewMode=="week"){
    start=new Date(currentDate);
    start.setDate(start.getDate()-start.getDay());
    days=7;
    header.textContent=`Week of ${start.toLocaleDateString()}`;
  }else if(viewMode=="3day"){
    start=new Date(currentDate);
    days=3;
    const end = new Date(start.getTime()+2*86400000);
    header.textContent=`${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;
  }else{
    start=new Date(currentDate);
    days=1;
    header.textContent=currentDate.toDateString();
  }

  const grid=document.createElement("div");
  grid.className=viewMode=="month"?"grid":"flex";

  for(let i=0;i<days;i++){
    const d=new Date(start);
    d.setDate(start.getDate()+i);

    const cell=document.createElement("div");
    cell.className=viewMode=="month"?"day-cell":"col";
    const dayTasks=tasks.filter(t=>t.due==d.toISOString().slice(0,10));

    // Create date header
    const dateHeader=document.createElement("div");
    dateHeader.className="day-number";

    if(viewMode=="month"){
      // Show only number in month view
      dateHeader.textContent = d.getDate();
    } else {
      // Show weekday + date (e.g. Tuesday 5 October)
      const weekday = d.toLocaleDateString('default', { weekday:'long' });
      const day = d.getDate();
      const month = d.toLocaleDateString('default', { month:'long' });
      dateHeader.textContent = `${weekday} ${day} ${month}`;
    }

    cell.appendChild(dateHeader);

    if(viewMode=="month"){
      // Month view dots
      const dots=document.createElement("div");
      dots.className="day-dots";
      dayTasks.forEach(t=>{
        const dot=document.createElement("div");
        dot.className="dot";
        dot.style.background=courses[t.courseId]?.color || "#777";
        dots.appendChild(dot);
      });
      cell.appendChild(dots);
      cell.addEventListener("click",()=>openDayTasksModal(d,dayTasks));
    } else {
      // Full tasks for non-month views
      dayTasks.forEach(t=>{
        const div=document.createElement("div");
        div.className="task-row";
        const icon=document.createElement("span");
        icon.className="icon";
        icon.style.background=courses[t.courseId]?.color || "#777";
        div.appendChild(icon);
        const text=document.createElement("div");
        text.textContent=t.title;
        div.appendChild(text);
        div.addEventListener("click",()=>openEditModal(t));
        cell.appendChild(div);
      });
    }

    grid.appendChild(cell);
  }

  calendarEl.appendChild(grid);
}


  function renderTaskList(){
    const sorted=[...tasks].sort((a,b)=>a.due.localeCompare(b.due));
    taskListEl.innerHTML="";
    sorted.forEach(t=>{
      const el=document.createElement("div");
      el.className="task-row";
      const icon=document.createElement("span");
      icon.className="icon";
      icon.style.background=courses[t.courseId]?.color||"#777";
      const text=document.createElement("div");
      text.textContent=`${t.title} - ${t.due}`;
      el.appendChild(icon); el.appendChild(text);
      el.addEventListener("click",()=>openEditModal(t));
      taskListEl.appendChild(el);
    });
  }

  function render(){
    renderCalendar();
    renderTaskList();
  }

  async function loadData(){
    const courseSnap = await getDocs(collection(db,"courses"));
    courses = {};
    courseSnap.forEach(docu => courses[docu.id]=docu.data());
    updateCourseSelects();
    const taskSnap = await getDocs(collection(db,"tasks"));
    tasks = [];
    taskSnap.forEach(docu => tasks.push({id:docu.id, ...docu.data()}));
    render();
  }

  loadData();
</script>
</body>
</html>
